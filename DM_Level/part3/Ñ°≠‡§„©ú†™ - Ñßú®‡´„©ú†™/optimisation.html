<html>

<head>

<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-7">

<title>
Βελτιστοποίηση Επερωτήσεων
</title>

</head>

<body bgcolor="#FFFFFF" text="#000066" link="#3333CC" vlink="#666699" alink="#990099">

<center><h2>Βελτιστοποίηση Επερωτήσεων</h2></center>

<p>
Η βελτιστοποίηση επερωτήσεων είναι μία από τις πιο σημαντικές (αν όχι η σημαντικότερη) διαδικασίες που επιτελεί ένα Σύστημα
Διαχείρισης Βάσεων Δεδομένων. Την εργασία αυτή αναλαμβάνει ένα συγκεκριμένο τμήμα του ΣΔΒΔ, το οποίο καλείται βελτιστοποιητής.
Στη συνέχεια περιγράφεται συνοπτικά η λειτουργικότητα του δομοστοιχείου αυτού.
</p>

<h3>Βελτιστοποιητής επερωτήσεων</h3>

<p>
Για την εκτέλεση μίας επερώτησης υπάρχουν (στη συντριπτική πλειοψηφία των περιπτώσεων) περισσότεροι από ένας τρόποι εξαγωγής του
τελικού αποτελέσματος. Οι τρόποι αυτοί ονομάζονται πλάνα εκτέλεσης <i>(excecution plans)</i>. Τα πλάνα εκτέλεσης είναι ισοδύναμα,
με την έννοια ότι παράγουν όλα ακριβώς τα ίδια αποτελέσματα. Στην πράξη όμως τα πλάνα αυτά διαφοροποιούνται (πολλές φορές εντυπωσιακά)
στο χρονικό διάστημα που χρειάζονται για να τερματίσουν. Η χρηστικότητα μίας βάσης δεδομένων εξαρτάται σε πολύ μεγάλο βαθμό από το
αν τα αποτελέσματα των επερωτήσεων είναι διαθέσιμα στο χρήστη μετά από ένα τουλάχιστον αποδεκτό (και όσο το δυνατόν μικρότερο) διάστημα
αναμονής. Για το λόγο αυτό, ο βελτιστοποιητής επερωτήσεων υποχρεούται να επιλέγει το βέλτιστο (ή κάποιο που να το πλησιάζει) πλάνο εκτέλεσης
για κάθε επερώτηση που γίνεται από το χρήστη. Εν μέρει, η εργασία αυτή του βελτιστοποιητή στηρίζεται σε ένα σύνολο από στατιστικά
στοιχεία που αποθηκεύονται στη βάση δεδομένων.
</p>

<h3>Στατιστικά στοιχεία</h3>

<p>
Τα στατιστικά στοιχεία που αποθηκεύονται στη βάση περιλαμβάνουν τουλάχιστον τα εξής:
<br>
<br>

<table border="1" cellpadding="10">
<tr>
<td align="center"><b><i>{R}</i></b></td> <td>Πλήθος εγγραφών της σχέσης R</td>
</tr>
<tr>
<td align="center"><b><i>|R|</i></b></td> <td>Πλήθος blocks της σχέσης R</td>
</tr>
<tr>
<td align="center"><b><i>V(R, x)</i></b></td> <td>Πλήθος διακριτών τιμών στο πεδίο x της σχέσης R</td>
</tr>
<tr>
<td align="center"><b><i>min(R, x)</i></b></td> <td>Ελάχιστη τιμή που εμφανίζεται στο πεδίο x της σχέσης R</td>
</tr>
<tr>
<td align="center"><b><i>max(R, x)</i></b></td> <td>Μέγιστη τιμή που εμφανίζεται στο πεδίο x της σχέσης R</td>
</tr>
</table>

<br>

Σχετικά με την εργασία, τα ανωτέρω αποθηκεύονται στους πίνακες <i>relCat</i> και <i>attrCat</i> της βάσης.
Το πλήθος εγγραφών <i>{R}</i> είναι παράμετρος που αφορά σε μία σχέση, οπότε διατηρείται στο <i>relCat</i>.
Το πλήθος blocks <i>|R|</i> μίας σχέσης δε θα χρειαστεί καθόλου για τη συγκεκριμένη άσκηση, οπότε δεν είναι
αναγκαίο να αποθηκεύεται κάπου. Οι υπόλοιποι τρεις δείκτες σχετίζονται με συγκεκριμένο πεδίο μίας σχέσης,
και επομένως κρατούνται στο <i>attrCat</i>.

<br>
<br>

<u>Σημείωση:</u> Το πλήθος διακριτών τιμών ενός πεδίου θα θεωρείτε για τις ανάγκες της άσκησης ότι ισούται με το πλήθος των εγγραφών
της σχέσης στην οποία ανήκει, σε περίπτωση που δεν υπάρχει ευρετήριο επί του συγκεκριμένου πεδίου. Αν όμως υπάρχει ευρετήριο, μπορεί
να χρησιμοποιηθεί για να ελεγχεί εάν κάποια εγγραφή που εισάγεται έχει τιμή στο πεδίο αυτό που εμφανίζεται για πρώτη φορά. Επομένως
θα ενημερώνεται κατάλληλα και το πλήθος διακριτών τιμών για το συγκεκριμένο πεδίο.

</p>

<h3>Επιλεκτικότητα</h3>

<p>

Η επιλεκτικότητα <i>(selectivity)</i> είναι μία παράμετρος που υπολογίζει το σχετικό μέγεθος της απάντησης (δηλαδή το πλήθος των εγγραφών) σε
μία επερώτηση επιλογής. Υποθέτωντας ομοιόμορφη κατανομή δεδομένων (κάτι που στην πράξη σπάνια ισχύει, αλλά θα αποδεχτείτε για
την υλοποίησή σας), η επιλεκτικότητα για την επιλογή από μία σχέση <i>R</i> των εγγραφών που ικανοποιούν κάποια συνθήκη μπορεί
προσεγγιστικά να υπολογιστεί ως εξής:
<br>
<br>

<table border="1" cellpadding="10">
<tr align="center">
<td><b><i>Τελεστής &lt OP&gt</i></b></td> <td><b><i>Επιλεκτικότητα</i></b></td> <td><b><i>Συμβολισμός</i></b></td>
</tr>
<tr align="center">
<td>=</td> <td>1 / V(R, x)</td> <td>sel(x = α)</td>
</tr>
<tr align="center">
<td>&lt</td> <td>[val - min(R, x)] / [max(R, x) - min(R, x)]</td> <td>sel(x < α)</td>
</tr>
<tr align="center">
<td>&lt=</td> <td>sel(x < a) + sel(x = a)</td> <td>sel(x <= α)</td>
</tr>
<tr align="center">
<td>&gt</td> <td>[max(R, x) - val] / [max(R, x) - min(R, x)]</td> <td>sel(x > α)</td>
</tr>
<tr align="center">
<td>&gt=</td> <td>sel(x > a) + sel(x = a)</td> <td>sel(x >= α)</td>
</tr>
<tr align="center">
<td>!=</td> <td>1 - sel(x = a)</td> <td>sel(x != α)</td>
</tr>
</table>

<br>

Η τιμή <i>val</i> είναι αυτή με την οποία γίνεται η σύγκριση σε κάθε περίπτωση. Προφανώς, η επιλεκτικότητα παίρνει τιμές στο κλειστό
διάστημα [0, 1], όπου το 0 αντιστοιχεί σε απουσία από τη σχέση <i>R</i> εγγραφών που ικανοποιούν κάποια συνθήκη, και το 1 στην περίπτωση
που η <i>R</i> περιέχει μόνο εγγραφές που ικανοποιούν τη συνθήκη. Για να εκτιμηθεί το πλήθος των εγγραφών που θα επιστρέψει μία επερώτηση
επιλογής, μπορεί να χρησιμοποιηθεί ο εξής τύπος:
<br>
<br>

<table border="1" cellpadding="10">
<tr align="center">
<td><i>πλήθος εγγραφών απάντησης = πλήθος εγγραφών σχέσης * επιλεκτικότητα τελεστή = {R} * sel(x &lt OP&gt α)</i></td>
</tr>
</table>

<br>

όπου <i>&lt OP&gt</i> είναι ένας από τους τελεστές (συνθήκες) που περιέχονται στον προηγούμενο πίνακα.
<br>
<br>

<u>Σημείωση:</u> Στην περίπτωση που ένα συγκεκριμένο γνώρισμα δεν είναι αριθμητικού τύπου (π.χ. μία συμβολοσειρά), είναι αναγκαία κάποια
τροποποίηση στους ανωτέρω τύπους. Η αντιμετώπιση της συγκεκριμένης περίπτωσης περιγράφεται <a href="string.html">εδώ</a>.

</p>

<h3>Τύποι επερωτήσεων και υλοποίηση</h3>

<p>
Στο κείμενο που ακολουθεί, χρησιμοποιούνται οι εξής συμβολισμοί:
</p>

<p>
Οι τύποι επερωτήσεων που θα χρειαστεί να χειριστείτε είναι συνολικά τρεις:

<ul>
<li>Απλή επιλογή με συνθήκη</li>
<li>Απλή ζεύξη με συνθήκη</li>
<li>Επιλεκτική ζεύξη</li>
</ul>

Στην περίπτωση της επιλεκτικής ζεύξης υπάρχουν δύο διαφορετικές δυνατότητες υλοποίησης, οι οποίες περιγράφονται παρακάτω.
<br>
<br>
<br>

<i>Απλή επιλογή με συνθήκη</i>
<br>
<br>

<img src="opt_images/select.png" title="Απλή επιλογή με συνθήκη"/>
<br>

Πρόκειται για την απλούστερη επερώτηση που μπορεί να γίνει επί μίας σχέσης R. Αν υπάρχει ευρετήριο στο πεδίο επιλογής τότε
πρέπει να το χρησιμοποιήσετε. Αν δεν δίνεται καμία συνθήκη, τότε η απάντηση θα πρέπει να περιλαμβάνει όλες τις
εγγραφές της σχέσης R (και συγκεκριμένα τα πεδία αυτών που προσδιορίζει η επερώτηση).
<br>
<br>
<br>

<i>Απλή ζεύξη με συνθήκη</i>
<br>
<br>

<img src="opt_images/join.png" title="Απλή ζεύξη με συνθήκη"/>
<br>

Πρόκειται για μία ζέυξη μεταξύ δύο σχέσεων R και S, όπου μία εγγραφή της R ζευγαρώνει μία εγγραφή της S, αν για το πεδίο x της
πρώτης και το πεδίο y της δεύτερης ισχύει η σχέση &lt OP&gt . Η αντιστοίχιση που προκύπτει δεν είναι γενικά ένα-προς-ένα.
Η υλοποίηση της ζεύξης για τις ανάγκες της εργασίας θα πρέπει να γίνει χρησιμοποιώντας τον αλγόριθμο των εμφωλιασμένων βρόχων
(επιπέδου εγγραφής ή επιπέδου block). Ανάλογα με το αν υπάρχει ή όχι ευρετήριο επί των πεδίων x, y των σχέσεων R και S
διακρίνονται οι εξής τρεις περιπτώσεις:

<ol>
<li>
Καμία από τις δύο σχέσεις δεν έχει ευρετήριο στο πεδίο ζεύξης. Στην περίπτωση αυτή ως εσωτερική σχέση στους εμφωλιασμένους βρόχους
τοποθετείται η μεγαλύτερη.
</li>
<li>
Μόνο μια από τις δύο σχέσεις έχει ευρετήριο στο πεδίο ζεύξης. Στην περίπτωση αυτή η εν λόγω σχέση τοποθετείται στον εσωτερικό βρόχο
του αλγορίθμου.
</li>
<li>
Και οι δύο σχέσεις έχουν ευρετήριο στο πεδίο ζεύξης. Στην περίπτωση αυτή στον εσωτερικό βρόχο τοποθετείται η μεγαλύτερη.
</li>
</ol>

Προφανώς, αν υπάρχει ευρετήριο στην εσωτερική σχέση θα πρέπει να χρησιμοποιηθεί. Παρατηρείστε ότι η αντιμετώπιση στις περιπτώσεις
(1) και (3) είναι κοινή. Σημειώστε επίσης ότι στη ζεύξη υπάρχει δυνατότητα να συμμετέχουν δύο στιγμιότυπα του ίδιου αρχείου και όχι
υποχρεωτικά δύο διαφορετικά αρχεία εγγραφών.
<br>
<br>
<br>

<i>Επιλεκτική ζεύξη με τοποθέτηση της επιλογής στον εσωτερικό βρόχο</i>
<br>
<br>

<img src="opt_images/selectiveJoin1.png" title="Επιλεκτική ζεύξη με τοποθέτηση της επιλογής στον εσωτερικό βρόχο"/>
<br>

Η επερώτηση εδώ είναι σύνθετη, και περιλαμβάνει μία επιλογή και μία ζεύξη. Στην περίπτωση αυτή πραγματοποιείται πρώτα
η επιλογή επί της σχέσης S και τα αποτελέσματα εισάγονται σε μία προσωρινή σχέση. Στη συνέχεια εκτελείται η ζεύξη μεταξύ της R και
της προσωρινής αυτής σχέσης. Σημειώστε και πάλι ότι στην πράξη υπάρχει δυνατότητα να συμμετέχουν δύο στιγμιότυπα του ίδιου αρχείου
και όχι υποχρεωτικά δύο διαφορετικά αρχεία εγγραφών. 
<br>
<br>
<br>

<i>Επιλεκτική ζεύξη με τοποθέτηση της επιλογής στον εξωτερικό βρόχο</i>
<br>
<br>

<img src="opt_images/selectiveJoin2.png" title="Επιλεκτική ζεύξη με τοποθέτηση της επιλογής στον εξωτερικό βρόχο"/>
<br>

Η επερώτηση περιλαμβάνει και πάλι μία επιλογή και μία ζεύξη, μόνο που τώρα η επιλογή βρίσκεται στα αριστερά της έκφρασης και η αντιμετώπιση
είναι κάπως διαφορετική. Αντίθετα με την προηγούμενη περίπτωση, εδώ δε χρησιμοποιείται κάποια προσωρινή σχέση. Καθώς εκτελείται η
επιλογή επί της σχέσης S, τα αποτελέσματα τροφοδοτούνται άμεσα (μία εγγραφή ή ένα block τη φορά, καθώς αυτά προκύπτουν από την επιλογή)
στη ζεύξη με τη σχέση R. Η διαδικασία αυτή λέγεται σωλήνωση <i>(pipelining)</i>. Στην εργασία ζητείται η σωλήνωση να γίνεται σε επίπεδο block.

</p>

<p>

<u>Σημείωση:</u> Η επιλεκτική ζεύξη είναι μία σύνθεση των βασικών πράξεων της επιλογής και της ζεύξης. Ως εκ τούτου, η απόφαση για το
ποιά από τις δύο προαναφερθείσες μεθόδους θα χρησιμοποιηθεί προκύπτει με συνδυασμό των κριτηρίων που εφαρμόζονται στις επιμέρους πράξεις.

</p>

</body>

</html>
